# YOLO-MoE-Dynamic ğŸš€
# NC: 80 (ä¾æ®ä½ çš„æ•°æ®é›†è°ƒæ•´)
nc: 80
scales:
  n: [0.50, 0.25, 1024] # ä¿æŒçª„è€Œæ·±ï¼Œé€‚åˆ MoE æ‰©å±•å®¹é‡
  s: [0.50, 0.50, 1024]

backbone:
  # Stage 1: åŸºç¡€ä¸‹é‡‡æ ·
  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 2, C3k2, [256, False, 0.25]] # 2-P2

  # Stage 2: P3 æµ…å±‚ç‰¹å¾ (ä¿æŒé«˜æ•ˆ)
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [256, False, 0.25]] # 4

  # Stage 3: P4 ä¸­å±‚ç‰¹å¾ (å¼•å…¥åŠ¨æ€è°ƒåˆ¶ C3k2_Dynamic)
  - [-1, 1, Conv, [256, 3, 2]] # 5-P4/16
  - [-1, 3, C3k2_Dynamic, [512, False, 0.25]] # 6: åŠ¨æ€å¢å¼ºï¼Œä¸º MoE é“ºè·¯
  - [-1, 1, OptimizedMOEImproved, [512, 4, 2, 'simple', 'efficient']] # 7: 4ä¸“å®¶ MoE

  # Stage 4: P5 æ·±å±‚ç‰¹å¾ (å¼•å…¥ LSKA å¤§æ„Ÿå—é‡ + é«˜å®¹é‡ MoE)
  - [-1, 1, Conv, [512, 3, 2]] # 8-P5/32
  - [-1, 4, C2f_LSKA, [512, True]] # 9: å¤§è§†é‡æ„ŸçŸ¥
  - [-1, 1, OptimizedMOEImproved, [512, 8, 2, 'simple', 'efficient']] # 10: 8ä¸“å®¶ MoE æå‡å®¹é‡

  # Stage 5: P6 æœ€æ·±å±‚ (å¯é€‰ï¼Œé’ˆå¯¹å¤§åˆ†è¾¨ç‡)
  - [-1, 1, Conv, [1024, 3, 2]] # 11
  - [-1, 4, C2f_LSKA, [1024, True]] # 12
  - [-1, 1, OptimizedMOEImproved, [1024, 8, 2, 'simple', 'efficient']] # 13: 8ä¸“å®¶æè‡´å®¹é‡

head:
  # --- ç‰¹å¾èåˆ (PAN/FPNç»“æ„) ---
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 10], 1, Concat, [1]] # è¿æ¥ P5 è¾“å‡º
  - [-1, 2, C3k2_Dynamic, [512, True]] # 16: Head åŒæ ·åŠ¨æ€åŒ–

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 7], 1, Concat, [1]] # è¿æ¥ P4 è¾“å‡º
  - [-1, 2, C3k2_Dynamic, [256, True]] # 19

  - [-1, 1, Conv, [256, 3, 2]]
  - [[-1, 16], 1, Concat, [1]]
  - [-1, 2, C3k2_Dynamic, [512, True]] # 22

  - [-1, 1, Conv, [512, 3, 2]]
  - [[-1, 13], 1, Concat, [1]]
  - [-1, 2, C3k2_Dynamic, [512, True]] # 25

  # --- é¢„æµ‹å¤´ ---
  - [[19, 22, 25], 1, Detect, [nc]]
